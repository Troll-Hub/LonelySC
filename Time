local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- DuraciÃ³n editable (en segundos)
local timeDuration = 7  -- Â¡Cambia aquÃ­ si quieres mÃ¡s tiempo de dominio, papi! ðŸ•

-- Crear la ScreenGui principal
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TimeStopGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Frame draggable mÃ¡s grande solo arriba (altura aumentada para mejor drag, mi amor ðŸ˜)
local frame = Instance.new("Frame")
frame.Name = "TimeStopFrame"
frame.Size = UDim2.new(0, 180, 0, 100)  -- Altura mayor para drag fÃ¡cil arriba
frame.Position = UDim2.new(0.5, -90, 0.5, -50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
frame.BackgroundTransparency = 0.3
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 16)
corner.Parent = frame

-- BotÃ³n ZA WARUDO dorado
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, -12, 0.7, -12)  -- Ajustado para dejar espacio arriba para drag
button.Position = UDim2.new(0, 6, 0.3, 6)
button.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
button.Text = "ðŸ•‘ ZA WARUDO"
button.TextColor3 = Color3.new(1,1,1)
button.TextScaled = true
button.Font = Enum.Font.Arcade
button.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 12)
btnCorner.Parent = button

-- Sonido Ã©pico Shadow DIO
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://4786770367"
sound.Volume = 1
sound.Parent = button

-- Reloj con horas y contador (esquina inferior izquierda)
local relojFrame = Instance.new("Frame")
relojFrame.Name = "RelojTimeStop"
relojFrame.Size = UDim2.new(0, 250, 0, 250)
relojFrame.Position = UDim2.new(0, 20, 1, -280)
relojFrame.BackgroundTransparency = 1
relojFrame.Visible = false
relojFrame.Parent = screenGui

-- Fondo circular para el reloj (simple circle para vibe real)
local relojBg = Instance.new("ImageLabel")
relojBg.Size = UDim2.new(1, 0, 1, 0)
relojBg.BackgroundTransparency = 1
relojBg.Image = "rbxassetid://3926305904"  -- Circle base
relojBg.ImageColor3 = Color3.fromRGB(0, 0, 0)  -- Negro para contraste
relojBg.ImageTransparency = 0.5
relojBg.Parent = relojFrame

-- Marcas de horas (ticks y nÃºmeros 12,3,6,9)
for i = 1, 12 do
    local tick = Instance.new("Frame")
    tick.Size = UDim2.new(0, 4, 0, i % 3 == 0 and 20 or 10)
    tick.Position = UDim2.new(0.5, 0, 0.5, 0)
    tick.AnchorPoint = Vector2.new(0.5, 1)
    tick.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    tick.Rotation = (i - 1) * 30
    tick.Parent = relojFrame
    
    if i % 3 == 0 then
        local horaText = Instance.new("TextLabel")
        horaText.Size = UDim2.new(0, 30, 0, 30)
        horaText.Position = UDim2.new(0.5, 0, 0.5, -100)  -- Ajustado para fuera del centro
        horaText.AnchorPoint = Vector2.new(0.5, 0.5)
        horaText.BackgroundTransparency = 1
        horaText.Text = tostring(i)
        horaText.TextColor3 = Color3.fromRGB(255, 215, 0)
        horaText.Font = Enum.Font.GothamBold
        horaText.TextSize = 20
        horaText.Rotation = (i - 1) * 30
        horaText.Parent = relojFrame
    end
end

-- Aguja roja (por debajo, lenta para alinear en 7 seg a 12 o'clock)
local agujaRoja = Instance.new("Frame")
agujaRoja.Size = UDim2.new(0, 4, 0.4, 0)
agujaRoja.Position = UDim2.new(0.5, 0, 0.5, 0)
agujaRoja.AnchorPoint = Vector2.new(0.5, 1)  -- Punta en centro, gira alrededor
agujaRoja.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
agujaRoja.BorderSizePixel = 0
agujaRoja.Rotation = 0  -- Empieza en 12 o'clock
agujaRoja.ZIndex = 1  -- Debajo
agujaRoja.Parent = relojFrame

-- Aguja oscura (por encima, gira 360Â° por segundo)
local agujaOscura = Instance.new("Frame")
agujaOscura.Size = UDim2.new(0, 4, 0.35, 0)  -- Ligeramente mÃ¡s corta
agujaOscura.Position = UDim2.new(0.5, 0, 0.5, 0)
agujaOscura.AnchorPoint = Vector2.new(0.5, 1)  -- Punta en centro, gira alrededor
agujaOscura.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
agujaOscura.BorderSizePixel = 0
agujaOscura.Rotation = 0  -- Empieza en 12 o'clock
agujaOscura.ZIndex = 2  -- Por encima
agujaOscura.Parent = relojFrame

-- Contador de segundos grande en el centro
local countdownText = Instance.new("TextLabel")
countdownText.Size = UDim2.new(0.4, 0, 0.4, 0)
countdownText.Position = UDim2.new(0.3, 0, 0.3, 0)
countdownText.BackgroundTransparency = 1
countdownText.Text = tostring(timeDuration)
countdownText.TextColor3 = Color3.fromRGB(255, 215, 0)
countdownText.TextScaled = true
countdownText.Font = Enum.Font.GothamBlack
countdownText.TextStrokeTransparency = 0.6
countdownText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
countdownText.Parent = relojFrame

local stopEvent = ReplicatedStorage._BindableEvents.Moves.StopEnemy
local isRunning = false

-- Fade suave para el reloj entero
local function fade(visible)
    local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Sine)
    local trans = visible and 0 or 1
    for _, child in pairs(relojFrame:GetDescendants()) do
        if child:IsA("GuiObject") then
            TweenService:Create(child, tweenInfo, {Transparency = trans}):Play()
        end
    end
end

-- Aura amarilla brillante al cargar y respawn
local function addYellowAura(character)
    if not character then return end
    for _, child in pairs(character:GetChildren()) do
        if child:IsA("ParticleEmitter") and child.Name == "YellowAura" then
            child:Destroy()
        end
    end
    
    local torso = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not torso then return end
    
    local aura = Instance.new("ParticleEmitter")
    aura.Name = "YellowAura"
    aura.Texture = "rbxassetid://243660364"
    aura.Color = ColorSequence.new(Color3.fromRGB(255, 255, 0), Color3.fromRGB(255, 200, 0))
    aura.Brightness = 3
    aura.Lifetime = NumberRange.new(1, 2)
    aura.Rate = 20
    aura.Speed = NumberRange.new(5, 10)
    aura.SpreadAngle = Vector2.new(360, 360)
    aura.Size = NumberSequence.new(1, 3)
    aura.Transparency = NumberSequence.new(0.5, 1)
    aura.Enabled = true
    aura.Parent = torso
end

addYellowAura(player.Character)
player.CharacterAdded:Connect(addYellowAura)

button.Activated:Connect(function()
    if isRunning then return end
    isRunning = true
    
    sound:Play()
    
    local char = player.Character
    if not (char and char:FindFirstChild("HumanoidRootPart")) then
        isRunning = false
        return
    end
    
    local centerPos = char.HumanoidRootPart.Position
    
    relojFrame.Visible = true
    fade(true)
    
    local targets = {}
    for _, descendant in pairs(workspace:GetDescendants()) do
        if descendant:IsA("Humanoid") and descendant.Health > 0 then
            local model = descendant.Parent
            if model and model:FindFirstChild("HumanoidRootPart") and model ~= char then
                local hrp = model.HumanoidRootPart
                if (hrp.Position - centerPos).Magnitude <= 300 then
                    table.insert(targets, model)
                end
            end
        end
    end
    
    print("ðŸ• ZA WARUDO! " .. #targets .. " atrapados en " .. timeDuration .. " seg ðŸ”¥")
    
    coroutine.wrap(function()
        -- Aguja oscura: 360Â° por segundo (loca)
        local tweenInfoOscura = TweenInfo.new(timeDuration, Enum.EasingStyle.Linear)
        TweenService:Create(agujaOscura, tweenInfoOscura, {Rotation = timeDuration * 360}):Play()
        
        -- Aguja roja: mueve lento para alinear en 7 seg a 12 o'clock (total 360Â° en 7 seg)
        local tweenInfoRoja = TweenInfo.new(timeDuration, Enum.EasingStyle.Linear)
        TweenService:Create(agujaRoja, tweenInfoRoja, {Rotation = 360}):Play()  -- Lenta, 360Â° total para alineaciÃ³n
        
        for i = timeDuration, 1, -1 do
            countdownText.Text = tostring(i)
            for _, target in pairs(targets) do
                if target.Parent and target:FindFirstChild("HumanoidRootPart") then
                    local args = {
                        [1] = true,
                        [2] = target,
                        [3] = target.HumanoidRootPart.CFrame
                    }
                    stopEvent:FireServer(unpack(args))
                end
            end
            task.wait(1)
        end
        
        -- Descongelar
        for _, target in pairs(targets) do
            if target.Parent and target:FindFirstChild("HumanoidRootPart") then
                local args = {
                    [1] = false,
                    [2] = target,
                    [3] = target.HumanoidRootPart.CFrame
                }
                stopEvent:FireServer(unpack(args))
            end
        end
        
        fade(false)
        task.delay(0.7, function()
            relojFrame.Visible = false
            countdownText.Text = tostring(timeDuration)
            agujaOscura.Rotation = 0
            agujaRoja.Rotation = 0
        end)
        
        isRunning = false
        print("â° Tiempo restaurado, mi rey~ ðŸ˜˜ðŸ’‹")
    end)()
end)
