local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- DuraciÃ³n editable (en segundos)
local timeDuration = 7

-- Crear la ScreenGui principal
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TimeStopGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Frame draggable para el botÃ³n
local frame = Instance.new("Frame")
frame.Name = "TimeStopFrame"
frame.Size = UDim2.new(0, 180, 0, 70)
frame.Position = UDim2.new(0.5, -90, 0.5, -35)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
frame.BackgroundTransparency = 0.3
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 16)
corner.Parent = frame

-- BotÃ³n ZA WARUDO dorado
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, -12, 1, -12)
button.Position = UDim2.new(0, 6, 0, 6)
button.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
button.Text = "ðŸ•‘ ZA WARUDO"
button.TextColor3 = Color3.new(1,1,1)
button.TextScaled = true
button.Font = Enum.Font.Arcade
button.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 12)
btnCorner.Parent = button

-- Efecto gris para time stop
local cc = Instance.new("ColorCorrectionEffect")
cc.Name = "TimeStopCC"
cc.Saturation = -1
cc.Enabled = false
cc.Parent = Lighting

-- Sonido Ã©pico Shadow DIO
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://4786770367"
sound.Volume = 1
sound.Parent = button

-- Reloj JoJo con fondo Shadow DIO
local relojFrame = Instance.new("Frame")
relojFrame.Name = "JoJoClockDIO"
relojFrame.Size = UDim2.new(0, 250, 0, 250)
relojFrame.Position = UDim2.new(0, 20, 1, -280)
relojFrame.BackgroundTransparency = 0
relojFrame.Visible = false
relojFrame.Parent = screenGui

-- Fondo Shadow DIO con el nuevo ID que pediste
local dioBackground = Instance.new("ImageLabel")
dioBackground.Size = UDim2.new(1, 0, 1, 0)
dioBackground.BackgroundTransparency = 1
dioBackground.Image = "rbxassetid://4279786905"  -- Â¡Nuevo ID hot y perfecto, papi! ðŸ”¥
dioBackground.ImageTransparency = 0.45
dioBackground.ScaleType = Enum.ScaleType.Fit
dioBackground.Parent = relojFrame

-- Imagen base del reloj circular
local relojImage = Instance.new("ImageLabel")
relojImage.Size = UDim2.new(1, 0, 1, 0)
relojImage.BackgroundTransparency = 0
relojImage.Image = "rbxassetid://4279786905"
relojImage.ImageColor3 = Color3.fromRGB(255, 255, 255)
relojImage.Parent = relojFrame

-- Aguja roja: SOLO UNA, punta en el centro, girando como reloj real
local aguja = Instance.new("Frame")
aguja.Size = UDim2.new(0, 6, 0.48, 0)  -- Largo desde centro hacia afuera
aguja.Position = UDim2.new(0.5, -3, 0.5, 0)  -- Centro exacto
aguja.AnchorPoint = Vector2.new(0.5, 1)  -- Pivote en la punta inferior (centro del reloj)
aguja.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
aguja.BorderSizePixel = 0
aguja.Rotation = 0
aguja.Parent = relojFrame

-- Texto countdown grande en el centro
local countdownText = Instance.new("TextLabel")
countdownText.Size = UDim2.new(0.7, 0, 0.4, 0)
countdownText.Position = UDim2.new(0.15, 0, 0.3, 0)
countdownText.BackgroundTransparency = 1
countdownText.Text = tostring(timeDuration)
countdownText.TextColor3 = Color3.fromRGB(255, 215, 0)
countdownText.TextScaled = true
countdownText.Font = Enum.Font.GothamBlack
countdownText.TextStrokeTransparency = 0.6
countdownText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
countdownText.Parent = relojFrame

local stopEvent = ReplicatedStorage._BindableEvents.Moves.StopEnemy
local isRunning = false

-- Fade suave
local function fade(visible)
    local tweenInfo = TweenInfo.new(0.6, Enum.EasingStyle.Sine)
    local trans = visible and 0.45 or 1
    TweenService:Create(dioBackground, tweenInfo, {ImageTransparency = trans}):Play()
    TweenService:Create(relojImage, tweenInfo, {ImageTransparency = trans}):Play()
    TweenService:Create(countdownText, tweenInfo, {TextTransparency = visible and 0 or 1}):Play()
    TweenService:Create(aguja, tweenInfo, {BackgroundTransparency = visible and 0 or 1}):Play()
end

button.Activated:Connect(function()
    if isRunning then return end
    isRunning = true
    
    sound:Play()
    cc.Enabled = true
    
    local char = player.Character
    if not (char and char:FindFirstChild("HumanoidRootPart")) then
        cc.Enabled = false
        isRunning = false
        return
    end
    
    local centerPos = char.HumanoidRootPart.Position
    
    -- Hitbox blanco transparente con efecto aire parado
    local hitboxPart = Instance.new("Part")
    hitboxPart.Shape = Enum.PartType.Ball
    hitboxPart.Size = Vector3.new(600, 600, 600)
    hitboxPart.Position = centerPos
    hitboxPart.Anchored = true
    hitboxPart.CanCollide = false
    hitboxPart.Transparency = 0.75
    hitboxPart.BrickColor = BrickColor.new("Institutional white")
    hitboxPart.Material = Enum.Material.Neon
    hitboxPart.Parent = workspace
    
    local airEffect = Instance.new("ParticleEmitter")
    airEffect.Name = "StoppedAir"
    airEffect.Texture = "rbxassetid://241837032"
    airEffect.Color = ColorSequence.new(Color3.new(1,1,1))
    airEffect.Lifetime = NumberRange.new(10, 15)
    airEffect.Rate = 100
    airEffect.Speed = NumberRange.new(0, 0)
    airEffect.SpreadAngle = Vector2.new(180, 180)
    airEffect.Size = NumberSequence.new(0.5, 0.5)
    airEffect.Transparency = NumberSequence.new(0.8, 0.9)
    airEffect.Enabled = true
    airEffect.TimeScale = 0
    airEffect.Parent = hitboxPart
    
    relojFrame.Visible = true
    fade(true)
    
    local targets = {}
    for _, descendant in pairs(workspace:GetDescendants()) do
        if descendant:IsA("Humanoid") and descendant.Health > 0 then
            local model = descendant.Parent
            if model and model:FindFirstChild("HumanoidRootPart") and model ~= char then
                local hrp = model.HumanoidRootPart
                if (hrp.Position - centerPos).Magnitude <= 300 then
                    table.insert(targets, model)
                end
            end
        end
    end
    
    print("ðŸ• ZA WARUDO! " .. #targets .. " atrapados en " .. timeDuration .. " seg ðŸ”¥")
    
    coroutine.wrap(function()
        -- Aguja gira como reloj real: una sola direcciÃ³n, vueltas completas por segundo
        local tweenInfoAguja = TweenInfo.new(timeDuration, Enum.EasingStyle.Linear)
        TweenService:Create(aguja, tweenInfoAguja, {Rotation = timeDuration * 360}):Play()
        
        for i = timeDuration, 1, -1 do
            countdownText.Text = tostring(i)
            for _, target in pairs(targets) do
                if target.Parent and target:FindFirstChild("HumanoidRootPart") then
                    local args = {
                        [1] = true,
                        [2] = target,
                        [3] = target.HumanoidRootPart.CFrame
                    }
                    stopEvent:FireServer(unpack(args))
                end
            end
            task.wait(1)
        end
        
        -- Descongelar
        for _, target in pairs(targets) do
            if target.Parent and target:FindFirstChild("HumanoidRootPart") then
                local args = {
                    [1] = false,
                    [2] = target,
                    [3] = target.HumanoidRootPart.CFrame
                }
                stopEvent:FireServer(unpack(args))
            end
        end
        
        cc.Enabled = false
        if hitboxPart then hitboxPart:Destroy() end
        
        fade(false)
        task.delay(0.7, function()
            relojFrame.Visible = false
            countdownText.Text = tostring(timeDuration)
            aguja.Rotation = 0
        end)
        
        isRunning = false
        print("â° Tiempo restaurado, mi rey~ ðŸ˜˜ðŸ’‹")
    end)()
end)
