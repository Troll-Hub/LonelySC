-- Divine UI - Conexi贸n con PIN simple + Executor Remoto + Chat Directo (Arceus V5)

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local pin = ""
local dataChannel
local messages = {}

-- UI Principal: Divine UI
local gui = Instance.new("ScreenGui")
gui.Parent = game.CoreGui
gui.Name = "DivineUI"
gui.IgnoreGuiInset = true

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0.45, 0, 0.65, 0)
mainFrame.Position = UDim2.new(0.275, 0, 0.175, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = gui
mainFrame.Active = true
mainFrame.Draggable = true

-- Drag touch-friendly
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then update(input) end
end)

-- T铆tulo
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0.08, 0)
title.Text = "Divine UI - Conexi贸n por PIN"
title.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
title.TextColor3 = Color3.new(1, 0.8, 0)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Parent = mainFrame

-- PIN Input
local pinLabel = Instance.new("TextLabel")
pinLabel.Size = UDim2.new(0.4, 0, 0.08, 0)
pinLabel.Position = UDim2.new(0.05, 0, 0.1, 0)
pinLabel.Text = "PIN (4 d铆gitos):"
pinLabel.BackgroundTransparency = 1
pinLabel.TextColor3 = Color3.new(1,1,1)
pinLabel.Parent = mainFrame

local pinBox = Instance.new("TextBox")
pinBox.Size = UDim2.new(0.5, 0, 0.08, 0)
pinBox.Position = UDim2.new(0.45, 0, 0.1, 0)
pinBox.Text = "1234"
pinBox.PlaceholderText = "Ej: 1234"
pinBox.Parent = mainFrame

-- Bot贸n Conectar
local connectButton = Instance.new("TextButton")
connectButton.Size = UDim2.new(0.9, 0, 0.08, 0)
connectButton.Position = UDim2.new(0.05, 0, 0.2, 0)
connectButton.Text = "Conectar con PIN"
connectButton.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
connectButton.TextColor3 = Color3.new(1,1,1)
connectButton.Parent = mainFrame

-- Executor Remoto
local execLabel = Instance.new("TextLabel")
execLabel.Size = UDim2.new(0.9, 0, 0.06, 0)
execLabel.Position = UDim2.new(0.05, 0, 0.3, 0)
execLabel.Text = "Executor Remoto (ejecuta en el otro)"
execLabel.BackgroundTransparency = 1
execLabel.TextColor3 = Color3.new(1,1,1)
execLabel.Parent = mainFrame

local codeBox = Instance.new("TextBox")
codeBox.Size = UDim2.new(0.9, 0, 0.2, 0)
codeBox.Position = UDim2.new(0.05, 0, 0.36, 0)
codeBox.MultiLine = true
codeBox.ClearTextOnFocus = false
codeBox.Text = "-- C贸digo Lua para el otro"
codeBox.Parent = mainFrame

local execBtn = Instance.new("TextButton")
execBtn.Size = UDim2.new(0.45, 0, 0.06, 0)
execBtn.Position = UDim2.new(0.05, 0, 0.57, 0)
execBtn.Text = "Ejecutar en Otro"
execBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
execBtn.TextColor3 = Color3.new(1,1,1)
execBtn.Parent = mainFrame

local clearBtn = Instance.new("TextButton")
clearBtn.Size = UDim2.new(0.45, 0, 0.06, 0)
clearBtn.Position = UDim2.new(0.5, 0, 0.57, 0)
clearBtn.Text = "Borrar"
clearBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
clearBtn.TextColor3 = Color3.new(1,1,1)
clearBtn.Parent = mainFrame

-- Chat Directo
local chatLabel = Instance.new("TextLabel")
chatLabel.Size = UDim2.new(0.9, 0, 0.06, 0)
chatLabel.Position = UDim2.new(0.05, 0, 0.65, 0)
chatLabel.Text = "Chat Directo"
chatLabel.BackgroundTransparency = 1
chatLabel.TextColor3 = Color3.new(1,1,1)
chatLabel.Parent = mainFrame

local chatScroll = Instance.new("ScrollingFrame")
chatScroll.Size = UDim2.new(0.9, 0, 0.2, 0)
chatScroll.Position = UDim2.new(0.05, 0, 0.71, 0)
chatScroll.BackgroundTransparency = 1
chatScroll.CanvasSize = UDim2.new(0,0,0,0)
chatScroll.Parent = mainFrame

local msgInput = Instance.new("TextBox")
msgInput.Size = UDim2.new(0.7, 0, 0.06, 0)
msgInput.Position = UDim2.new(0.05, 0, 0.93, 0)
msgInput.Text = ""
msgInput.PlaceholderText = "Escribe mensaje..."
msgInput.Parent = mainFrame

local sendBtn = Instance.new("TextButton")
sendBtn.Size = UDim2.new(0.2, 0, 0.06, 0)
sendBtn.Position = UDim2.new(0.75, 0, 0.93, 0)
sendBtn.Text = "Mandar"
sendBtn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
sendBtn.TextColor3 = Color3.new(1,1,1)
sendBtn.Parent = mainFrame

-- Conexi贸n con PIN (usando WebSocket relay simple - cambia por tu propio si quieres)
local WS_URL = "wss://divine-chat-relay.glitch.me"  -- Relay gratis y simple (puedes hostear tu propio en Glitch/Replit)

local function connectWithPin()
    pin = pinBox.Text
    if #pin ~= 4 then
        print("隆PIN debe ser de 4 d铆gitos, papi! ")
        return
    end

    local ws = WebSocket.connect(WS_URL)

    ws.OnOpen:Connect(function()
        ws:Send(HttpService:JSONEncode({type = "join", pin = pin, name = player.Name}))
        print("隆Conectado al PIN " .. pin .. "! ")
    end)

    ws.OnMessage:Connect(function(raw)
        local data = HttpService:JSONDecode(raw)
        if data.type == "message" then
            addMessage("[Otro]: " .. data.text)
        elseif data.type == "execute" then
            pcall(function()
                loadstring(data.code)()
                print("隆C贸digo divino ejecutado desde el otro! ")
            end)
        end
    end)

    -- Funciones para enviar
    local function send(type, payload)
        if ws then
            ws:Send(HttpService:JSONEncode({type = type, pin = pin, payload = payload}))
        end
    end

    execBtn.MouseButton1Click:Connect(function()
        send("execute", codeBox.Text)
    end)

    clearBtn.MouseButton1Click:Connect(function()
        codeBox.Text = ""
    end)

    sendBtn.MouseButton1Click:Connect(function()
        if msgInput.Text ~= "" then
            send("message", msgInput.Text)
            addMessage("[Yo]: " .. msgInput.Text)
            msgInput.Text = ""
        end
    end)
end

connectButton.MouseButton1Click:Connect(connectWithPin)

-- Agregar mensaje al chat
function addMessage(text)
    table.insert(messages, text)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, 0, 0, 25)
    lbl.Text = text
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.BackgroundTransparency = 1
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = chatScroll
    chatScroll.CanvasSize = UDim2.new(0,0,0,#messages*25)
end

print("=== Divine UI Cargada!  Escribe tu PIN y toca 'Conectar con PIN' ===")
