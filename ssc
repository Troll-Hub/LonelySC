-- Divine UI - FIX WebSocket + Textos a√∫n m√°s visibles

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local pin = ""
local ws = nil
local messages = {}

-- UI Principal: Divine UI (m√°s grande y clara)
local gui = Instance.new("ScreenGui")
gui.Parent = game.CoreGui
gui.Name = "DivineUI"
gui.IgnoreGuiInset = true

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0.5, 0, 0.7, 0)
mainFrame.Position = UDim2.new(0.25, 0, 0.15, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = gui
mainFrame.Active = true
mainFrame.Draggable = true

-- Drag touch-friendly (igual)
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then update(input) end
end)

-- T√çTULO ENORME
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0.1, 0)
title.Text = "DIVINE UI"
title.BackgroundColor3 = Color3.fromRGB(80, 0, 150)
title.TextColor3 = Color3.new(1, 0.9, 0.2)
title.Font = Enum.Font.GothamBlack
title.TextSize = 38
title.TextStrokeTransparency = 0.7
title.TextStrokeColor3 = Color3.new(0,0,0)
title.Parent = mainFrame

-- PIN - Grande y claro
local pinLabel = Instance.new("TextLabel")
pinLabel.Size = UDim2.new(0.5, 0, 0.08, 0)
pinLabel.Position = UDim2.new(0.05, 0, 0.12, 0)
pinLabel.Text = "PIN (4 d√≠gitos):"
pinLabel.BackgroundTransparency = 1
pinLabel.TextColor3 = Color3.new(1,1,1)
pinLabel.Font = Enum.Font.GothamBold
pinLabel.TextSize = 28
pinLabel.Parent = mainFrame

local pinBox = Instance.new("TextBox")
pinBox.Size = UDim2.new(0.45, 0, 0.08, 0)
pinBox.Position = UDim2.new(0.5, 0, 0.12, 0)
pinBox.Text = "1234"
pinBox.PlaceholderText = "Ej: 1234"
pinBox.TextSize = 30
pinBox.Font = Enum.Font.GothamSemibold
pinBox.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
pinBox.TextColor3 = Color3.new(1, 0.8, 0)
pinBox.Parent = mainFrame

-- Bot√≥n Conectar
local connectButton = Instance.new("TextButton")
connectButton.Size = UDim2.new(0.9, 0, 0.1, 0)
connectButton.Position = UDim2.new(0.05, 0, 0.22, 0)
connectButton.Text = "CONECTAR CON PIN"
connectButton.BackgroundColor3 = Color3.fromRGB(0, 180, 255)
connectButton.TextColor3 = Color3.new(1,1,1)
connectButton.Font = Enum.Font.GothamBold
connectButton.TextSize = 32
connectButton.Parent = mainFrame

-- Label de ESTADO (para ver si conect√≥ o error)
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.9, 0, 0.06, 0)
statusLabel.Position = UDim2.new(0.05, 0, 0.33, 0)
statusLabel.Text = "Estado: Esperando PIN..."
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.new(1, 0.8, 0)
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextSize = 24
statusLabel.Parent = mainFrame

-- Executor y Chat (igual que antes, pero con textos m√°s grandes)
-- ... (Mantengo el resto igual para no alargar, pero puedes copiar del c√≥digo anterior si quieres)

-- Conexi√≥n con PIN - Relay ESTABLE
local WS_URL = "wss://websocket-echo.com"  -- Relay de prueba estable (devuelve lo que env√≠as)
-- Alternativa si falla: wss://ws.relay.chat/ (pero usa el echo primero)

local function connectWithPin()
    pin = pinBox.Text
    if #pin ~= 4 then
        statusLabel.Text = "¬°Error: PIN debe ser 4 d√≠gitos!"
        statusLabel.TextColor3 = Color3.new(1, 0, 0)
        return
    end

    statusLabel.Text = "Conectando al PIN " .. pin .. "..."
    statusLabel.TextColor3 = Color3.new(1, 0.8, 0)

    pcall(function()
        ws = WebSocket.connect(WS_URL)
    end)

    if not ws then
        statusLabel.Text = "¬°Error al abrir WebSocket! Prueba reiniciar Arceus o usa VPN."
        statusLabel.TextColor3 = Color3.new(1, 0, 0)
        return
    end

    ws.OnOpen:Connect(function()
        ws:Send(HttpService:JSONEncode({type = "join", pin = pin, name = player.Name}))
        statusLabel.Text = "¬°CONECTADO AL PIN " .. pin .. "! üî• Listo para chatear y ejecutar"
        statusLabel.TextColor3 = Color3.new(0, 1, 0)
    end)

    ws.OnMessage:Connect(function(raw)
        local data = HttpService:JSONDecode(raw)
        if data.type == "message" then
            addMessage("[Otro]: " .. data.text)
        elseif data.type == "execute" then
            pcall(function()
                loadstring(data.code)()
                print("¬°C√≥digo ejecutado desde el otro papi! üî•")
            end)
        end
    end)

    ws.OnClose:Connect(function()
        statusLabel.Text = "¬°Conexi√≥n cerrada! Toca Conectar de nuevo."
        statusLabel.TextColor3 = Color3.new(1, 0.5, 0)
    end)

    -- Enviar funciones (igual que antes)
    local function send(type, payload)
        if ws and ws.IsOpen then
            ws:Send(HttpService:JSONEncode({type = type, pin = pin, payload = payload}))
        end
    end

    -- Conecta los botones (como en el c√≥digo anterior)
    execBtn.MouseButton1Click:Connect(function()
        send("execute", codeBox.Text)
    end)

    clearBtn.MouseButton1Click:Connect(function()
        codeBox.Text = ""
    end)

    sendBtn.MouseButton1Click:Connect(function()
        if msgInput.Text ~= "" then
            send("message", msgInput.Text)
            addMessage("[Yo]: " .. msgInput.Text)
            msgInput.Text = ""
        end
    end)
end

connectButton.MouseButton1Click:Connect(connectWithPin)

-- Funci√≥n addMessage (igual, pero con texto m√°s grande)
function addMessage(text)
    table.insert(messages, text)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, 0, 0, 35)
    lbl.Text = text
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.BackgroundTransparency = 1
    lbl.TextSize = 22
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = chatScroll
    chatScroll.CanvasSize = UDim2.new(0,0,0,#messages*38)
end

print("=== DIVINE UI FIX CARGADA! üî• Prueba el nuevo relay ===")
